<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monolingual Text Checker</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>Monolingual Text Checker</h1>
  <h3>Check a text for sensitive terms</h3>

  <br>

  <form class="container" id="textform">
    <div class="container" id="container">
      <div class="backdrop" id="backdrop">
        <div class="highlights">
          {{- marked_html | safe -}}
        </div>
      </div>
      <textarea id="textarea" name="user_text" placeholder="Add a text you would like to check for sensitive terms">{{ user_text }}</textarea>
      
    </div>
    <div class="radio-buttons">
      <input type="radio" id="english" name="language" value="english" checked>
      <label for="english">English</label>
      <input type="radio" id="german" name="language" value="german">
      <label for="german">German</label>
    </div>
    <br>
    <button type="submit">Check</button>
    <button id="edit_text">Edit text</button>
  </form>

</body>

<script>
  var backdrop = document.getElementById("backdrop");

  

  var textarea = document.getElementById("textarea");
  var edit_button= document.getElementById("edit_text");
  edit_button.addEventListener("click", (event) =>{
    console.log(textarea);
    textarea.style.pointerEvents = "all";
  });

  textarea.addEventListener("scroll",(event) => {
    var scrollTop = textarea.scrollTop;
    backdrop.scrollTop = scrollTop;
  });

  function showPopup(t){
    console.log("hover");
    console.log(t.target);
    t.target.childNodes[1].style.visibility = "visible";
  }

  function hidePopup(t){
    console.log("hover leave");
    console.log(t.target);
    t.target.childNodes[1].style.visibility = "hidden";
  }
  
  // const overlay = document.getElementById("overlay");
  // overlay.addEventListener("mouseover", function(event) {
  //       const target = event.target;
        
  //       // Check if the mouseover target is a mark
  //       if (target.classList.contains("mark")) {
  //           // Show the popup
  //           showPopup(event);
  //       }
  //   });

  // // Add event listeners to handle mouseout events to hide the popup
  // overlay.addEventListener("mouseout", function(event) {
  //     hidePopup(event);
  // });


  var container = document.getElementById("container");
  const form = document.querySelector("#textform");
  async function sendData() {
    // Associate the FormData object with the form element
    const formData = new FormData(form);
    console.log(formData)

    fetch("{{ url_for('submit') }}", {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(data => {
        
        container.innerHTML = data;
        // attatch new event listeners
        backdrop = document.getElementById("backdrop");
        var textarea2 = document.getElementById("textarea");
        textarea2.addEventListener("scroll",(event) => {
          var scrollTop = textarea2.scrollTop;
          backdrop.scrollTop = scrollTop;
        });
        edit_button.addEventListener("click", (event) =>{
          console.log(textarea2);
          //textarea2.style.pointerEvents = "all";
          textarea2.style.pointerEvents = "all";
          // textarea2.style.setProperty("background-color", "blue", "important");
        });
        

        // const overlay = document.getElementById("overlay");
        // overlay.addEventListener("mouseover", function(event) {
        //       const target = event.target;
              
        //       // Check if the mouseover target is a mark
        //       if (target.classList.contains("mark")) {
        //           // Show the popup
        //           showPopup(event);
        //       }
        //   });

        // // Add event listeners to handle mouseout events to hide the popup
        // overlay.addEventListener("mouseout", function(event) {
        //     hidePopup(event);
        // });

        var marks = document.querySelectorAll('.popup');
        for (var i = 0; i < marks.length; i++) {

          console.log("mark", marks[i]);
          marks[i].addEventListener("mouseenter", showPopup, marks[i]);
          marks[i].addEventListener("mouseleave", hidePopup, marks[i]);
        }     
        textarea2.style.pointerEvents = "none";
       // textarea2.style.setProperty("background-color", "red");

    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });

  }

  var marks = document.querySelectorAll('.popup');
  for (var i = 0; i < marks.length; i++) {
    console.log("mark", marks[i]);
    marks[i].addEventListener("mouseenter", showPopup, marks[i]);
    marks[i].addEventListener("mouseleave", hidePopup, marks[i]);
  }   
  // Take over form submission
  form.addEventListener("submit", (event) => {
    event.preventDefault();
    sendData();
  });
  </script>
</html>
